{
  "dashboard": {
    "title": "Streaming Pipeline Monitoring",
    "tags": ["streaming", "flink", "kafka", "ml"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "Kafka Lag Ð¸ Throughput",
        "type": "row",
        "panels": [
          {
            "id": 2,
            "title": "Kafka Consumer Lag",
            "type": "timeseries",
            "targets": [
              {
                "expr": "kafka_consumergroup_lag",
                "legendFormat": "{{consumergroup}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 500 },
                    { "color": "red", "value": 1000 }
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Kafka Throughput",
            "type": "stat",
            "targets": [
              {
                "expr": "rate(kafka_topic_partition_current_offset[5m])",
                "legendFormat": "{{topic}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ops",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "red", "value": null },
                    { "color": "yellow", "value": 100 },
                    { "color": "green", "value": 500 }
                  ]
                }
              }
            }
          }
        ]
      },
      {
        "id": 4,
        "title": "Flink Processing Metrics",
        "type": "row",
        "panels": [
          {
            "id": 5,
            "title": "Flink Processing Latency (p95)",
            "type": "timeseries",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, sum(rate(flink_taskmanager_job_task_operator_currentEmitEventTimeLag_bucket[5m])) by (le, job_name, operator_name))",
                "legendFormat": "{{job_name}} - {{operator_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ms",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 50 },
                    { "color": "red", "value": 75 }
                  ]
                }
              }
            }
          },
          {
            "id": 6,
            "title": "Flink Backpressure",
            "type": "gauge",
            "targets": [
              {
                "expr": "flink_taskmanager_job_task_backPressuredTimeMsPerSecond",
                "legendFormat": "{{operator_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ms",
                "max": 1000,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 100 },
                    { "color": "red", "value": 500 }
                  ]
                }
              }
            }
          }
        ]
      },
      {
        "id": 7,
        "title": "ML Pipeline Metrics",
        "type": "row",
        "panels": [
          {
            "id": 8,
            "title": "ML Inference Latency",
            "type": "timeseries",
            "targets": [
              {
                "expr": "ml_inference_latency_count",
                "legendFormat": "Total requests"
              },
              {
                "expr": "rate(ml_inference_latency_sum[5m]) / rate(ml_inference_latency_count[5m])",
                "legendFormat": "Avg latency"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ms"
              }
            }
          },
          {
            "id": 9,
            "title": "Data Drift Score",
            "type": "gauge",
            "targets": [
              {
                "expr": "data_drift_score",
                "legendFormat": "Drift Score"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percentunit",
                "max": 1,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 0.1 },
                    { "color": "red", "value": 0.2 }
                  ]
                }
              }
            }
          }
        ]
      },
      {
        "id": 10,
        "title": "Error Monitoring",
        "type": "row",
        "panels": [
          {
            "id": 11,
            "title": "DLQ Messages",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(dlq_messages_total[5m])",
                "legendFormat": "{{error_type}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ops"
              }
            }
          },
          {
            "id": 12,
            "title": "Validation Errors",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(validation_errors_total) by (field)",
                "legendFormat": "{{field}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short"
              }
            }
          }
        ]
      },
      {
        "id": 13,
        "title": "System Metrics",
        "type": "row",
        "panels": [
          {
            "id": 14,
            "title": "CPU Usage",
            "type": "gauge",
            "targets": [
              {
                "expr": "100 - (avg by(instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
                "legendFormat": "{{instance}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "max": 100,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 70 },
                    { "color": "red", "value": 90 }
                  ]
                }
              }
            }
          },
          {
            "id": 15,
            "title": "Memory Usage",
            "type": "gauge",
            "targets": [
              {
                "expr": "(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100",
                "legendFormat": "{{instance}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "max": 100,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 70 },
                    { "color": "red", "value": 90 }
                  ]
                }
              }
            }
          }
        ]
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    }
  }
}